# WFBeam Sketcher: Maker.js & Paper.js Driven Architecture

This document outlines a revised architecture for WFBeam Sketcher, focusing on Maker.js and Paper.js as the core technologies for 2D geometry, rendering, and interactivity. This approach simplifies the stack and accelerates development for the current roadmap.

---

## 1. Goals & Brief
- Interactive, inspector-friendly tool for beam annotation and reporting
- Modular, modern web UI
- Accurate, scalable 2D rendering (beam cross-section, elevation, grid)
- Rich annotation, callouts, and export (SVG, PNG, JSON, PDF)

---

## 2. Core Technologies: Maker.js + Paper.js

### Why Maker.js?
- Robust, parametric 2D geometry modeling (beams, grids, outlines)
- TypeScript-friendly, modular, and precise
- Generates geometry data for rendering and export

### Why Paper.js?
- Powerful 2D scene graph and rendering engine
- Handles interactive editing, hit-testing, and UI events
- Imports geometry from Maker.js for display and manipulation
- Supports SVG import/export and raster export (PNG)

---

## 3. Proposed Architecture

### Geometry Layer
- All core geometry (beam profiles, grid overlays, callout shapes) is defined and generated using Maker.js models.
- Maker.js outputs geometry as SVG or path data.

### Rendering & Interaction Layer
- Paper.js is used to render the geometry generated by Maker.js.
- Paper.js manages all user interaction: selection, editing, annotation, and live feedback.
- UI controls (beam selection, grid size, tool selection) update the Maker.js model, which is then re-rendered in Paper.js.

### Data Layer
- Model state (beam, grid, callouts, annotations) is stored as JSON, including Maker.js parameters and Paper.js state as needed.
- Export/import:
  - SVG/PNG via Paper.js
  - JSON for model state
  - PDF via SVG-to-PDF conversion (optional)

---

## 4. Development Steps
1. **Integrate Maker.js** for geometry generation (beam, grid, callouts)
2. **Integrate Paper.js** for rendering and interactivity
3. **Wire up UI controls** to update Maker.js models and re-render in Paper.js
4. **Implement export/import** for SVG, PNG, and JSON
5. **Polish UI/UX** and ensure accessibility, responsiveness

---

## 5. Advantages
- Separation of concerns: geometry (Maker.js) vs. rendering/UI (Paper.js)
- Parametric, precise geometry with interactive, modern UI
- All roadmap features supported (interactive grid, annotation, export, etc.)
- Easy to extend or swap out rendering or geometry engine in the future

---

## 6. References
- [Maker.js](https://github.com/microsoft/maker.js)
- [Paper.js](https://github.com/paperjs/paper.js)

---

## 7. Workflow & Implementation Sketch

This section documents the intended user workflow and the implementation sketch for WFBeam Sketcher, serving as a guide for development and future reference.

### User Workflow
1. **Beam Selection**
   - User selects a W-beam profile from a catalog panel.
   - The selected beam cross-section and elevation are rendered in the main drawing area.

2. **Grid Overlay**
   - User enables a grid overlay on the beam elevation.
   - Grid size and alignment can be adjusted via a status bar or dedicated controls.
   - Clicking grid cells toggles their state (e.g., color for condition mapping).

3. **Annotation & Callouts**
   - User selects annotation tools from a tool palette (arrow+text, polygon, paintbrush, etc.).
   - Callouts can be attached to grid cells or beam features.
   - Right-clicking allows editing or deleting annotations.

4. **Legend & Status**
   - A legend panel displays grid state meanings and callout types.
   - Status bar provides live feedback (e.g., current tool, grid size).

5. **Export & Import**
   - User can export the annotated sketch as SVG, PNG, or PDF.
   - The full model (beam, grid, callouts) can be exported/imported as JSON for later editing or reporting.

### Implementation Sketch
- **UI Layer:**
  - React components for panels, tool palette, status bar, and dialogs.
  - Paper.js canvas as the main drawing area, managed by a `DrawingArea` component.
- **Rendering & Interaction:**
  - All geometry (beam, grid, callouts, polygons) as Paper.js objects.
  - Tools implemented as Paper.js event handlers, with state managed in React.
- **Data Model:**
  - Central JSON state for beam, grid, and annotations.
  - Sync between Paper.js scene and model state for undo/redo and export/import.
- **Export/Import:**
  - Use Paper.js for SVG/PNG export.
  - JSON for model state; optional PDF export via SVG-to-PDF conversion.

This workflow and implementation sketch should be referenced when developing or extending the application to ensure consistency and alignment with project goals.

---

**Next Steps:**
- Integrate Maker.js for geometry generation
- Integrate Paper.js into DrawingArea
- Refactor tools and UI to use Maker.js and Paper.js for all geometry and interactivity
- Implement export/import features
